<!doctype html>
<html lang="us">
<head>
	<meta charset="utf-8">
	<title>jQuery UI Example Page</title>
	<link href="css/jquery-ui.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">		
</head>
<body>
	<script src="js/jquery.js"></script>
	<script src="js/jquery-ui.js"></script>
	<script src="js/conversion.js"></script>

<h1>Traductor de Behaviour trees</h1>

<div class="ui-widget">
	<p>Traduce a C++ los JSON que exporta el <a href="http://behavior3js.guineashots.com/editor/#" target="_blank">editor de behaviour trees</a> de Behavior3JS.</p>
	<p>Traduce los nodos:
	<ul>
		<li>Sequence</li>
		<li>Priority</li>
		<li>Runner</li>
		<li>Condition</li>
	</ul>
	El nodo <b>Condition</b> es un custom node de tipo Composite y nombre "Condition" que se debe añadir a mano. Para facilitar el proceso se
	proporciona un árbol vacío con dicho nodo ya creado. Para utilizarlo, pulsar <a href="#" id="dialog-link" class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-newwin"></span>aquí</a> y copiar el JSON. Una vez copiado, utilizar la opción de
	importación de Behavior3JS (File->ImportTree).
	</p>
</div>

<div id="dialog" title="JSON con nodo Condition">
<pre>
{
	"title": "A Behavior Tree",
	"description": "",
	"root": null,
	"display": {
		"camera_x": 683,
		"camera_y": 321.5,
		"camera_z": 1,
		"x": 0,
		"y": 0
	},
	"properties": {},
	"nodes": {},
	"custom_nodes": [
		{
			"name": "Condition",
			"title": "Condition",
			"category": "composite"
		}
	]
}
</pre>
</div>

<div id="drop_zone_wrapper">
	<div id="drop_zone">Arrastra aquí uno o varios JSON</div>
	<div id="error_zone"></div>
	<div id="translation_tabs">
		<ul id="trees">
			<!--<li><a href="#tabs-1">Header</a></li>
			<li><a href="#tabs-2">Cpp</a></li>-->
		</ul>
		<!--<div id="tabs-1"><pre><div id="hfile"></div></pre></div>
		<div id="tabs-2"><pre><div id="cppfile"></div></pre></div>-->
	</div>
</div>

<script>
function handleFileSelect(evt) {
	evt.stopPropagation();
	evt.preventDefault();
	var files = evt.dataTransfer.files; // FileList object.

	// Removes all previous tabs
	$('#trees').html('');
	$('#translation_tabs > div').remove();
	
	// Remove all previous errors
	$('#error_zone').html('');
	
	// For each file, create the .h and .cpp files
	for (var i = 0, f; f = files[i]; i++) {	
	
		json2h(f, i+1, function(result, name, index) {
			if (result != null) {
				$("#trees").append('<li><a href="#tabs-' + (index * 2) + '">' + name + '.h</a></li>');
				$('#translation_tabs').append('<div id="tabs-' + (index * 2) + '"><pre><div id="hfile' + (index * 2) + '"></div></pre></div>');
				var h = '<p>' + result + '</p>';
				$('#hfile' + (index * 2)).append(h);
			}
		});
		json2cpp(f, i+1, function(result, name, index) {
			if (result != null) {
				$("#trees").append('<li><a href="#tabs-' + (index *2 + 1) + '">' + name + '.cpp</a></li>');
				$('#translation_tabs').append('<div id="tabs-' + (index *2 + 1) + '"><pre><div id="cppfile' + (index *2 + 1) + '"></div></pre></div>');
				var h = '<p>' + result + '</p>';
				$('#cppfile' + (index * 2 + 1)).append(h);
				$( "#translation_tabs" ).tabs( "refresh" );
				$("#translation_tabs").tabs("option", "active", 0);
			}
		});		
	}
}

function handleDragOver(evt) {
	evt.stopPropagation();
	evt.preventDefault();
	evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
}

// Setup the dnd listeners.
var dropZone = document.getElementById('drop_zone');
dropZone.addEventListener('dragover', handleDragOver, false);
dropZone.addEventListener('drop', handleFileSelect, false);

// Setup jquery Tabs
$( "#translation_tabs" ).tabs();

$( "#dialog" ).dialog({
	autoOpen: false,
	width: 400,
	buttons: [
	]
});

// Link to open the dialog
$( "#dialog-link" ).click(function( event ) {
	$( "#dialog" ).dialog( "open" );
	event.preventDefault();
});

// Hover states on the static widgets
$( "#dialog-link, #icons li" ).hover(
	function() {
		$( this ).addClass( "ui-state-hover" );
	},
	function() {
		$( this ).removeClass( "ui-state-hover" );
	}
);
</script>

</body>
</html>
